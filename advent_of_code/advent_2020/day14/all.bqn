ParseInt â† {
  +Â´(10 â‹† âŒ½â†•â‰ ğ•©) Ã— ('0'-Ëœ ğ•©)
}âš‡1

ParseBin â† {
  +Â´(2 â‹† âŒ½â†•â‰ ğ•©) Ã— ('0'-Ëœ ğ•©)
}âš‡1

ToBase2Str â† {
  b â† '0' + 2{âŒ½ğ•—|âŒŠâˆ˜Ã·âŸœğ•—âŸ(â†•1+Â·âŒŠğ•—â‹†â¼1âŒˆâŠ¢)} ğ•©
  ((36-â‰ b)â¥Š'0') âˆ¾ b
}âš‡0

# This is really not good, once predicates come to CBQN it will be nicer
ParseE â† {
  0 ParseE str :
    âŸ¨
     ParseInt (4â†“â†•âŠ‘(ğ•© âŠ ']')) âŠ str,
     ToBase2Str (ParseInt (2+âŠ‘(str âŠ '=')) â†“ str),
    âŸ© ;
  1 ParseE str :
    7 â†“ str 
}

Parse â† {
  ("mask" â‰¡ (â†•4) âŠ ğ•©) ParseE ğ•©
}âš‡1

MaskIt â† {
  'X' MaskIt a:  a ;
  '0' MaskIt a: '0';
  '1' MaskIt a: '1'
}âš‡0

RunStep â† {
  âŸ¨mask, memâŸ© RunStep line:
    âŸ¨36=â‰ line, mask, memâŸ© RunStepE line
}

RunStepE â† {
  âŸ¨0, mask, memâŸ© RunStepE addrâ€¿value: 
    âŸ¨mask, âŸ¨âŸ¨addr, ParseBin (mask MaskIt value)âŸ©âŸ© âˆ¾ memâŸ© ;
  âŸ¨1, mask, memâŸ© RunStepE newmask: âŸ¨newmask, memâŸ©
}

# parsed â† ParseÂ¨ â€¢FLines "data.txt"
parsed â† ParseÂ¨ â€¢FLines "testdata.bqn"

default â† Parse "mask = XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"

â€¢Out â€¢Repr ((((âŸ¨default, âŸ¨âŸ©âŸ© RunStep 0 âŠ‘ parsed) RunStep 1 âŠ‘ parsed) RunStep 2 âŠ‘ parsed) RunStep 3 âŠ‘ parsed)
âŸ¨default, âŸ¨âŸ©âŸ© RunStepÂ´ parsed
